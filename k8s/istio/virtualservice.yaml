apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: todo-vs
  namespace: todo-app
spec:
  hosts:
  - "*"
  gateways:
  - todo-gateway
  http:
  # Route pour l'API users - AVEC rewrite
  - match:
    - uri:
        prefix: /api/users
    rewrite:
      uri: /users
    route:
    - destination:
        host: users
        port:
          number: 5001
  # Route pour l'API tasks - AVEC rewrite
  - match:
    - uri:
        prefix: /api/tasks
    rewrite:
      uri: /tasks
    route:
    - destination:
        host: tasks
        port:
          number: 5002
  # Route par d√©faut vers le frontend (SANS match, SANS rewrite)
  - route:
    - destination:
        host: frontend
        port:
          number: 80